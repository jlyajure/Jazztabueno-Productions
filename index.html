<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=no">
    
    <title>Jazztabueno Productions</title>
    <meta name="description" content="La mejor m√∫sica en Jazztabueno Productions. Streaming exclusivo.">
    <meta name="theme-color" content="#000000"> <link rel="icon" type="image/png" sizes="192x192" href="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png?v=FINAL">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png?v=FINAL">
    <link rel="shortcut icon" href="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png?v=FINAL">
    
    <meta property="og:title" content="Jazztabueno Productions">
    <meta property="og:image" content="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png">
    <meta property="og:description" content="Radio Streaming Exclusivo">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; }
        :root { 
            --gold: #d4af37; 
            --bg-color: #050505; 
            --card-bg: #111111;
            --text-main: #e2e8f0;
        }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0; 
            min-height: 100vh; 
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%); 
            background-attachment: fixed; 
            color: var(--text-main); 
            overflow-x: hidden; 
        }
        
        h1, h2, .program-tag { font-family: 'Playfair Display', serif; }

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1511192336575-5a79af67a629?auto=format&fit=crop&q=80&w=1932') no-repeat center center/cover; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        #login-screen::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); }
        .login-card { position: relative; background: rgba(20, 20, 20, 0.95); border: 1px solid var(--gold); padding: 40px 25px; border-radius: 15px; text-align: center; width: 90%; max-width: 350px; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); }
        .login-logo { width: 140px; height: 140px; object-fit: contain; margin-bottom: 10px; border-radius: 15px; padding: 5px; }

        #passInput { width: 100%; padding: 15px; border: 1px solid #555; border-bottom: 2px solid var(--gold); background: #222; color: white; text-align: center; outline: none; margin-top: 20px; font-size: 18px; border-radius: 5px; }
        
        .btn-enter { background: var(--gold); color: black; border: none; padding: 12px 30px; border-radius: 30px; margin-top: 20px; font-weight: 800; cursor: pointer; font-size: 14px; letter-spacing: 1px; transition: 0.3s; }
        .btn-enter:hover { background: white; box-shadow: 0 0 15px white; }

        #app-content { display: none; padding-bottom: 80px; }
        
        header { 
            background: rgba(5, 5, 5, 0.95); 
            padding: 10px 20px; 
            position: sticky; top: 0; z-index: 100; 
            display: flex; justify-content: space-between; align-items: center; 
            border-bottom: 1px solid #222; 
        }
        .header-brand { display: flex; align-items: center; gap: 12px; }
        .header-logo { width: 45px; height: 45px; border-radius: 8px; object-fit: contain; background: black; border: 1px solid #333; }
        .brand-title { color: var(--gold); font-size: 13px; font-weight: 700; margin: 0; letter-spacing: 1px; text-transform: uppercase; line-height: 1.2; }
        .btn-logout { background: transparent; color: var(--gold); border: 1px solid var(--gold); padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; cursor: pointer; letter-spacing: 1px; text-transform: uppercase; }

        .container { max-width: 600px; margin: auto; padding: 20px 15px; }

        .channels-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; padding: 10px 0; }
        .channel-item { display: flex; flex-direction: column; align-items: center; width: 70px; cursor: pointer; transition: transform 0.2s; }
        .channel-item:hover { transform: scale(1.05); }
        .channel-logo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #333; padding: 2px; background: #000; transition: 0.3s; }
        .channel-name { font-size: 9px; color: #888; margin-top: 5px; font-weight: bold; text-transform: uppercase; text-align: center; }
        .channel-item.active .channel-logo { border-color: var(--gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.5); }
        .channel-item.active .channel-name { color: var(--gold); }

        .upload-section { background: #1a1a1a; border: 1px dashed var(--gold); padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center; display: none; }
        
        .input-dark { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 6px; background: #333; border: 1px solid #888; color: white; font-size: 14px; cursor: text; }
        .input-dark:focus { background: #444; border-color: var(--gold); outline: none; }
        .input-dark::placeholder { color: #aaa; }

        .btn-gold { background: var(--gold); color: black; padding: 12px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; margin-bottom: 10px; }
        .btn-safe { background: #222; border: 1px solid var(--gold); color: var(--gold); padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; margin-bottom: 20px; font-size: 14px; }
        .btn-safe:hover { background: var(--gold); color: black; }
        .btn-toggle-upload { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 10px; width: 100%; border-radius: 8px; margin-bottom: 20px; cursor: pointer; display: none; }

        .episode-card { background: var(--card-bg); border-radius: 15px; margin-bottom: 25px; overflow: hidden; border: 1px solid #222; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        
        .cover-art-container { position: relative; width: 100%; height: 220px; overflow: hidden; background: #000; border-bottom: 1px solid #222; }
        .cover-blur { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-size: cover; background-position: center; filter: blur(20px) brightness(0.5); transform: scale(1.2); z-index: 1; }
        .cover-front { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 2; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.7)); }

        .episode-info { padding: 20px; }
        .program-tag { display: inline-block; font-size: 10px; color: black; padding: 4px 10px; border-radius: 4px; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 1px; }
        
        .tag-jazz { background: var(--gold); }
        .tag-studio { background: #3b82f6; color: white; }
        .tag-salsa { background: #ef4444; color: white; }
        .tag-old { background: #a8a29e; color: black; }

        .episode-title { font-size: 18px; margin: 0 0 5px 0; color: white; }
        .episode-date { font-size: 12px; color: #666; display: block; margin-bottom: 15px; }
        audio { width: 100%; height: 40px; margin-top: 10px; filter: invert(100%); border-radius: 20px; }
        .btn-delete { float: right; background: transparent; border: none; color: #ef4444; font-size: 20px; cursor: pointer; margin-top: -5px; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <img src="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png" class="login-logo">
        <h2 style="color: var(--gold); margin: 0; font-size: 22px;">JAZZTABUENO<br>PRODUCTIONS</h2>
        <p style="color: #888; font-size: 12px; margin-top: 10px;">Acceso Privado</p>
        
        <input type="password" id="passInput" placeholder="Clave de Producci√≥n">
        <button id="btnEnter" class="btn-enter">ENTRAR ‚ñ∂</button>
    </div>
</div>

<div id="app-content">
    <header>
        <div class="header-brand">
            <img src="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png" class="header-logo">
            <div class="brand-title">JAZZTABUENO<br>PRODUCTIONS</div>
        </div>
        <button class="btn-logout" id="btnSalir">SALIR üîí</button>
    </header>
    
    <div class="container">
        
        <button class="btn-toggle-upload" id="btnUpload">üì° SUBIR NUEVO PROGRAMA</button>
        
        <div id="upload-section" class="upload-section">
            <h3 style="color:var(--gold); margin-top:0;">Nuevo Programa</h3>
            <p style="color:#aaa; font-size:12px; margin-bottom:15px;">Tus datos se guardan autom√°ticamente mientras escribes.</p>

            <label style="color: #aaa; font-size: 12px; display:block; text-align:left; margin-bottom:5px;">Elige el Programa:</label>
            <select id="progInput" class="input-dark">
                <option value="JAZZTABUENO">üé∑ JAZZTABUENO</option>
                <option value="STUDIO79">üéß STUDIO 79</option>
                <option value="SALSA BRAVA">üî• SALSA BRAVA</option>
                <option value="OLD SCHOOL">üìª OLD SCHOOL RADIO</option>
            </select>
            
            <label style="color: #aaa; font-size: 12px; display:block; text-align:left; margin-bottom:5px;">T√≠tulo del Episodio:</label>
            <input type="text" id="titleInput" class="input-dark" placeholder="Ej: Especial H√©ctor Lavoe">
            
            <label style="color: #aaa; font-size: 12px; display:block; text-align:left; margin-bottom:5px;">Link del MP3 (Archive.org):</label>
            <input type="text" id="linkInput" class="input-dark" placeholder="Pegar Link AQU√ç (Ctrl + V)">
            
            <label style="color: #aaa; font-size: 12px; display:block; text-align:left; margin-bottom:5px;">Link de Car√°tula (PostImages):</label>
            <input type="text" id="imgInput" class="input-dark" placeholder="Pegar Link AQU√ç (Ctrl + V)">
            
            <button class="btn-gold" id="btnPublicar">LANZAR AL AIRE</button>
            <button class="btn-safe" onclick="subirModoSeguro()" style="margin-top:10px;">O usar Modo Ventana</button>

            <p id="status-msg" style="font-size:12px; color:#888; margin-top:10px;"></p>
        </div>

        <div class="channels-container">
            <div class="channel-item active" onclick="filtrar('Todo', this)">
                <img src="https://i.postimg.cc/GHMVbX6G/Jazz-Ta-Bueno-Productions.png" class="channel-logo">
                <span class="channel-name">Todo</span>
            </div>
            <div class="channel-item" onclick="filtrar('JAZZTABUENO', this)">
                <img src="https://i.postimg.cc/zVD4mstP/Jazztabueno-(2).png" class="channel-logo">
                <span class="channel-name">Jazz</span>
            </div>
            <div class="channel-item" onclick="filtrar('STUDIO79', this)">
                <img src="https://i.postimg.cc/NKMDbYJB/S79.png" class="channel-logo">
                <span class="channel-name">Studio 79</span>
            </div>
            <div class="channel-item" onclick="filtrar('SALSA BRAVA', this)">
                <img src="https://i.postimg.cc/75fchgyt/Salsa-Brava.png" class="channel-logo">
                <span class="channel-name">Salsa</span>
            </div>
            <div class="channel-item" onclick="filtrar('OLD SCHOOL', this)">
                <img src="https://i.postimg.cc/jwQ3mczC/Old-School-Radio.png" class="channel-logo">
                <span class="channel-name">Old School</span>
            </div>
        </div>

        <div id="radio-feed"></div>
    </div>
</div>

<script type="module">
    import { db } from "./firebase.js";
    import { collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const CLAVE_ACCESO = "jazz2026";
    const CLAVE_ADMIN = "ticoadmin"; 

    const CARATULAS = {
        'JAZZTABUENO': 'https://i.postimg.cc/zVD4mstP/Jazztabueno-(2).png',
        'STUDIO79':    'https://i.postimg.cc/NKMDbYJB/S79.png',
        'SALSA BRAVA': 'https://i.postimg.cc/75fchgyt/Salsa-Brava.png',
        'OLD SCHOOL':  'https://i.postimg.cc/jwQ3mczC/Old-School-Radio.png'
    };

    let todosLosEpisodios = [];
    let filtroActual = 'Todo';

    const saveDraft = () => {
        localStorage.setItem('draft_prog', document.getElementById('progInput').value);
        localStorage.setItem('draft_title', document.getElementById('titleInput').value);
        localStorage.setItem('draft_link', document.getElementById('linkInput').value);
        localStorage.setItem('draft_img', document.getElementById('imgInput').value);
    };

    const loadDraft = () => {
        if(localStorage.getItem('draft_title')) document.getElementById('titleInput').value = localStorage.getItem('draft_title');
        if(localStorage.getItem('draft_link')) document.getElementById('linkInput').value = localStorage.getItem('draft_link');
        if(localStorage.getItem('draft_img')) document.getElementById('imgInput').value = localStorage.getItem('draft_img');
        if(localStorage.getItem('draft_prog')) document.getElementById('progInput').value = localStorage.getItem('draft_prog');
    };

    const clearDraft = () => {
        localStorage.removeItem('draft_prog');
        localStorage.removeItem('draft_title');
        localStorage.removeItem('draft_link');
        localStorage.removeItem('draft_img');
        document.getElementById('titleInput').value = "";
        document.getElementById('linkInput').value = "";
        document.getElementById('imgInput').value = "";
    };

    document.getElementById('progInput').onchange = saveDraft;
    document.getElementById('titleInput').oninput = saveDraft;
    document.getElementById('linkInput').oninput = saveDraft;
    document.getElementById('imgInput').oninput = saveDraft;

    loadDraft();

    const checkAuth = () => {
        const storedKey = localStorage.getItem('jazz_auth');
        if(storedKey) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            if(storedKey === CLAVE_ADMIN) {
                document.getElementById('btnUpload').style.display = 'block';
            } else {
                document.getElementById('btnUpload').style.display = 'none';
            }
        }
    };
    checkAuth();

    document.getElementById('btnEnter').onclick = () => {
        const val = document.getElementById('passInput').value;
        if(val === CLAVE_ACCESO || val === CLAVE_ADMIN) {
            localStorage.setItem('jazz_auth', val);
            location.reload();
        } else {
            alert("Clave incorrecta üö´");
        }
    };

    document.getElementById('btnSalir').onclick = () => {
        if(confirm("¬øCerrar sesi√≥n?")) {
            localStorage.removeItem('jazz_auth');
            location.reload();
        }
    };

    document.getElementById('btnUpload').onclick = () => {
        const sec = document.getElementById('upload-section');
        sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
    };

    document.getElementById('btnPublicar').onclick = async () => {
        const programa = document.getElementById('progInput').value;
        const titulo = document.getElementById('titleInput').value;
        const link = document.getElementById('linkInput').value;
        const imgLink = document.getElementById('imgInput').value; 
        const status = document.getElementById('status-msg');

        if(!link || !titulo) { alert("Falta el link o el t√≠tulo"); return; }
        
        status.innerHTML = "üì° Conectando...";

        try {
            await addDoc(collection(db, "radio_programas"), {
                programa: programa,
                titulo: titulo,
                mp3Url: link, 
                imagenUrl: imgLink,
                fecha: new Date()
            });

            status.innerHTML = "‚úÖ ¬°En el aire!";
            clearDraft();
            setTimeout(() => { document.getElementById('upload-section').style.display = 'none'; status.innerHTML = ""; }, 2000);

        } catch (e) {
            alert("Error: " + e.message);
        }
    };

    window.subirModoSeguro = async () => {
        let prog = prompt("PASO 1/4\nEscribe el programa (JAZZ, SALSA, STUDIO o OLD):", "JAZZTABUENO");
        if (!prog) return;
        prog = prog.toUpperCase();
        const titulo = prompt("PASO 2/4\nEscribe el T√≠tulo del Episodio:", "Jazz Party");
        if (!titulo) return;
        const link = prompt("PASO 3/4\nPega el Link del MP3 (Archive.org) aqu√≠:");
        if (!link) return;
        const imgLink = prompt("PASO 4/4\nPega el Link de la Car√°tula (PostImages) o d√©jalo vac√≠o:", "");
        
        try {
            await addDoc(collection(db, "radio_programas"), {
                programa: prog,
                titulo: titulo,
                mp3Url: link, 
                imagenUrl: imgLink,
                fecha: new Date()
            });
            alert("‚úÖ ¬°√âXITO! Programa subido.");
            clearDraft();
            location.reload();
        } catch (e) {
            alert("Error: " + e.message);
        }
    };

    window.filtrar = (cat, elemento) => {
        filtroActual = cat;
        document.querySelectorAll('.channel-item').forEach(el => el.classList.remove('active'));
        if(elemento) elemento.classList.add('active');
        pintarRadio();
    };

    const q = query(collection(db, "radio_programas"), orderBy("fecha", "desc"));
    onSnapshot(q, (snapshot) => {
        todosLosEpisodios = [];
        snapshot.forEach((doc) => {
            todosLosEpisodios.push({ id: doc.id, ...doc.data() });
        });
        pintarRadio();
    });

    function pintarRadio() {
        const feed = document.getElementById('radio-feed');
        feed.innerHTML = "";
        const isAdmin = localStorage.getItem('jazz_auth') === CLAVE_ADMIN;
        
        const lista = todosLosEpisodios.filter(ep => filtroActual === 'Todo' || ep.programa.includes(filtroActual) || filtroActual.includes(ep.programa));

        if(lista.length === 0) {
            feed.innerHTML = `<div style="text-align:center; padding:40px; color:#444;">Sin transmisi√≥n en esta frecuencia... üìª</div>`;
            return;
        }

        lista.forEach(ep => {
            let tagClass = "tag-jazz";
            let imagenFondo = ep.imagenUrl && ep.imagenUrl.length > 5 ? ep.imagenUrl : ""; 

            if (!imagenFondo) {
                if(ep.programa.includes("JAZZ")) { imagenFondo = CARATULAS['JAZZTABUENO']; }
                if(ep.programa.includes("STUDIO")) { tagClass = "tag-studio"; imagenFondo = CARATULAS['STUDIO79']; }
                if(ep.programa.includes("SALSA")) { tagClass = "tag-salsa"; imagenFondo = CARATULAS['SALSA BRAVA']; }
                if(ep.programa.includes("OLD")) { tagClass = "tag-old"; imagenFondo = CARATULAS['OLD SCHOOL']; }
            } else {
                if(ep.programa.includes("STUDIO")) tagClass = "tag-studio";
                if(ep.programa.includes("SALSA")) tagClass = "tag-salsa";
                if(ep.programa.includes("OLD")) tagClass = "tag-old";
            }

            const fecha = ep.fecha ? ep.fecha.toDate().toLocaleDateString() : "";

            feed.innerHTML += `
                <div class="episode-card">
                    <div class="cover-art-container">
                        <div class="cover-blur" style="background-image: url('${imagenFondo}');"></div>
                        <div class="cover-front" style="background-image: url('${imagenFondo}');"></div>
                    </div>
                    <div class="episode-info">
                        <span class="program-tag ${tagClass}">${ep.programa}</span>
                        ${isAdmin ? `<button class="btn-delete" onclick="borrarEpisodio('${ep.id}')">üóëÔ∏è</button>` : ''}
                        <h3 class="episode-title">${ep.titulo}</h3>
                        <span class="episode-date">Publicado: ${fecha}</span>
                        <audio controls>
                            <source src="${ep.mp3Url}" type="audio/mpeg">
                            Tu navegador no soporta audio.
                        </audio>
                    </div>
                </div>
            `;
        });
    }

    window.borrarEpisodio = async (id) => {
        if(confirm("¬øEliminar este episodio del aire?")) {
            await deleteDoc(doc(db, "radio_programas", id));
        }
    };
</script>

</body>
</html>
